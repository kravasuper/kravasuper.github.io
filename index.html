<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset='utf-8'>
	<!-- <meta name='viewport' content='width=device-width,initial-scale=1'> -->

	<title>Krava.TV</title>

	<link rel='icon' type='image/png' href='/favicon.png'>
	<link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/reset-css@5.0.1/reset.min.css'>
	<link
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
		rel="stylesheet"
	/>
	<!-- Google Fonts -->
	<link
		href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
		rel="stylesheet"
	/>
	<link
		rel="stylesheet"
		href="https://cdn.jsdelivr.net/npm/@vime/core@^5/themes/default.css"
	/>
	<!-- <link rel='stylesheet' href='/global.css'> -->
	<link rel='stylesheet' href='/build/bundle.css'>
	<link rel='stylesheet' href='/build/circle.css'>
	<link rel='stylesheet' href='/build/mdb.min.css'>
	<style>
		body {
			/* background-color: #f6fafd; */
			background-color: rgb(250 245 255);
			min-width: 1200px;
		}
	</style>
	<script defer src='./build/bundle.js'></script>
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-47895360-1"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'UA-47895360-1');
	</script>
	<script src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>

<body>
	<google-cast-launcher id="castbutton"></google-cast-launcher>


	<a onclick="castNow()" >Cast!</a></br>
	<a onclick="loadNow()" >LOAD!</a>
	<!--<script src="/assets/js/cast.js"></script>-->
	<script>
	  var cast = {}
  
	  var castNow = function() {
		console.log('casting!')
		var sessionRequest = new chrome.cast.SessionRequest(chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID);
		chrome.cast.requestSession(function onRequestSessionSuccess(session) {
		  console.log('Session success', session)
		  cast.session = session
		}, function onLaunchError(er) {
		  console.log('onLaunchError', er)
		}, sessionRequest);
  
		setTimeout(function() {
		  var sessionRequest = new chrome.cast.SessionRequest(chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID);
		  chrome.cast.requestSession(function onRequestSessionSuccess(session) {
			console.log('Session success', session)
			cast.session = session
		  }, function onLaunchError(er) {
			console.log('onLaunchError', er)
		  }, sessionRequest);
  
		}, 1000)
  
	  }
  
  
	  var loadNow = function() {
  
  
		var englishSubtitle = new chrome.cast.media.Track(1, // track ID
		  chrome.cast.media.TrackType.TEXT);
		englishSubtitle.trackContentId = 'https://carlosguerrero.com/captions_styled.vtt';
		englishSubtitle.trackContentType = 'text/vtt';
		englishSubtitle.subtype = chrome.cast.media.TextTrackType.SUBTITLES;
		englishSubtitle.name = 'English Subtitles';
		englishSubtitle.language = 'en-US';
		englishSubtitle.customData = null;
  
  
		console.log('LoadNow, session:', cast.session)
		var mediaInfo = new chrome.cast.media.MediaInfo('http://commondatastorage.googleapis.com/gtv-videos-bucket/big_buck_bunny_1080p.mp4', 'video/mp4');
		mediaInfo.tracks = [englishSubtitle]
		mediaInfo.activeTrackIds = [1]
		request = new chrome.cast.media.LoadRequest(mediaInfo);
		cast.session.loadMedia(request,
		  onMediaDiscovered.bind(this, 'loadMedia'),
		  function(er) {
			console.log('onMediaError', er)
		  });
  
		function onMediaDiscovered(how, media) {
		  console.log('got media!', media)
		  cast.currentMedia = media;
		  var activeTrackIds = [1];
		  var tracksInfoRequest = new chrome.cast.media.EditTracksInfoRequest(activeTrackIds);
		  media.editTracksInfo(tracksInfoRequest, function succCB(){console.log('success changing trackIDs!')}, function errorCallback(){
			console.log('Error CB!')
		  });
		}
	  }
  
	  initializeCastApi = function() {
  
		console.log('initializing cast api')
		var sessionRequest = new chrome.cast.SessionRequest(chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID);
		var apiConfig = new chrome.cast.ApiConfig(sessionRequest,
		  function(session) {
			console.log('got session', session)
			cast.session = session
		  },
		  function receiverListener(e) {
			if (e === chrome.cast.ReceiverAvailability.AVAILABLE) {
			  console.log('receiver is available :)')
			}
		  })
  
		chrome.cast.initialize(apiConfig, function() {
			console.log('got initSuccess')
		  },
		  function(gotError) {
			console.log('gotError', gotError)
		  });
	  };
  
	  window.onload = function() {
		window['__onGCastApiAvailable'] = function(loaded, errorInfo) {
		  console.log('in __onGCastApiAvailable, loaded:', loaded)
		  if (loaded) {
			initializeCastApi()
		  }
		};
	  }
	</script>

	<!-- <button class="button" id="button">Loading</button> -->
	<!-- <script>
	var elements = document.getElementById("button");

	var initializeCastApi = function() {
		console.log('initializeCastApi');

		var sessionRequest = new chrome.cast.SessionRequest(
			chrome.cast.media.DEFAULT_MEDIA_RECEIVER_APP_ID);
		var apiConfig = new chrome.cast.ApiConfig(
				sessionRequest,
				sessionListener,
				receiverListener,
				chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
			  );
		chrome.cast.initialize(apiConfig, onInitSuccess, onError);
		console.log(apiConfig)
	};

	if (!chrome.cast || !chrome.cast.isAvailable) {
		setTimeout(initializeCastApi, 1000);
	}

	function onInitSuccess() {
		console.log('onInitSuccess');
	}

	function onError(e) {
		console.log('onError', e);
	}

	function sessionListener(e) {
		console.log('sessionListener', e);
	}

	function receiverListener(availability) {
		console.log('receiverListener', availability);
		elements.removeAttribute("disabled").textHTML("Start");
		if(availability === chrome.cast.ReceiverAvailability.AVAILABLE) {

			elements.removeAttribute("disabled").textContent("Start");
		}
	}

	function onSessionRequestSuccess(session) {
		console.log('onSessionRequestSuccess', session);

		var mediaInfo = new chrome.cast.media.MediaInfo();
		mediaInfo.contentUrl = "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";
		mediaInfo.contentType = "video/mp4";
		var request = new chrome.cast.media.LoadRequest(mediaInfo);
		session.loadMedia(request, onMediaLoadSuccess, onError);
	}

	function onMediaLoadSuccess(e) {
	console.log('onMediaLoadSuccess', e);
	}

	elements.onclick = function() {
		chrome.cast.requestSession(onSessionRequestSuccess, onError);
	}
	</script> -->

</body>
</html>
